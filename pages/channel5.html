<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Channel 5</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #00212a;
      overflow: hidden;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    // Tile class
    class Tile {
      constructor(gridX, gridY, size, type, c) {
        this.gridX = gridX;  
        this.gridY = gridY;  
        this.size = size;
        this.type = type;
        this.c = c;          
        
        // base position
        this.baseX = gridX * size;
        this.baseY = gridY * size;
      }
      
      update(time) {
        this.x = this.baseX;
        this.y = this.baseY;
        
        // horizontal shift - rows
        let horizontalShift = 0;
        if (this.gridY % 2 === 0) {
          horizontalShift = sin(time) * this.size;
        } else {
          horizontalShift = -sin(time) * this.size;
        }
        
        // vertical shift - columns
        let verticalShift = 0;
        if (this.gridX % 2 === 0) {
          verticalShift = cos(time * 1.1) * this.size;
        } else {
          verticalShift = -cos(time * 1.1) * this.size;
        }
        
        this.x += horizontalShift;
        this.y += verticalShift;
      }
      
      display() {
        push();
        translate(this.x, this.y);
        
        if (shapeType === 'triangles') {
          this.drawTriangles();
        } else if (shapeType === 'circles') {
          this.drawCircles();
        }
        
        pop();
      }
      
      // TRIANGLE 
      drawTriangles() {
        fill(this.c);
        noStroke();
        
        beginShape();
        blendMode(DIFFERENCE);
        if (this.type == 0) {
          vertex(this.size, 0);
          vertex(this.size, this.size);
          vertex(0, this.size);
          circle(20, this.size, 20);
        } else if (this.type == 1) {
          vertex(this.size, 0);
          vertex(0, 0);
          vertex(0, this.size);
          circle(this.size, 10, 20);
        } else if (this.type == 2) {
          vertex(this.size, this.size);
          vertex(0, 0);
          vertex(0, this.size);
        } else if (this.type == 3) {
          vertex(this.size, this.size);
          vertex(0, 0);
          vertex(this.size, 0);
        }
        
        endShape();
      }
      
      // CIRCLES
      drawCircles() {
        stroke(this.c);
        fill(this.c);
        
        blendMode(DIFFERENCE);
        strokeWeight(5);
        let circleType = this.type % 2;
        
        if (circleType == 0) {
          arc(0, 0, size, size, 0, 90);
          arc(size, size, size, size, 180, 270);
          circle(10, this.size, 5);
        } else {
          arc(size, 0, size, size, 90, 180);
          arc(0, size, size, size, 270, 360);
        }
      }
    }

    // Main sketch
    let tiles = [];
    let cols, rows;
    let size = 50;
    let speed = 0.05;
    let shapeType = 'triangles';
    let isDragging = false;
    let startMouseX = 0;
    let scaleFactor = 0.78; // Adjust this value

    function setup() {
      createCanvas(600 * scaleFactor, 600 * scaleFactor);
      createGrid();
    }

    function createGrid() {
      cols = width / scaleFactor / size;
      rows = height / scaleFactor / size;
      
      tiles = [];
      
      // grid
      for (let i = 0; i < cols; i++) {
        tiles[i] = [];
        for (let j = 0; j < rows; j++) {
          tiles[i][j] = new Tile(
            i, 
            j, 
            size, 
            floor(random(4)), 
            color(random(255), random(255), random(255))
          );
        }
      }
    }

    function draw() {
      background(0);
      
      push();
      scale(scaleFactor);
      
      // text
      push();
      fill(0);
      stroke(255);
      strokeWeight(4);
      textSize(18);
      textAlign(LEFT);
      text('press T and click the screen for surprises :)', 10, 25);
      pop();
      
      // for speed
      let Time = frameCount * speed;
      
      for (let i = 0; i < cols; i++) {
        for (let j = 0; j < rows; j++) {
          tiles[i][j].update(Time);
          tiles[i][j].display();
        }
      }
      
      pop();
    }

    function mousePressed() {
      // change grid size
      size = floor(random(10, 100));
      createGrid();
    }

    function keyPressed() {
      // switch between triangle and circle shapes
      if (key === 't' || key === 'T') {
        if (shapeType === 'triangles') {
          shapeType = 'circles';
        } else {
          shapeType = 'triangles';
        }
      }
    }
  </script>
</body>
</html>